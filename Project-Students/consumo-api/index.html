<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <form action="">
        <label for="id">Id</label><br>
        <input id="id" type="text">

        <br><br>

        <label for="name">Nome</label><br>
        <input id="name" type="text">

        <br><br>

        <label for="ra">Ra</label><br>
        <input id="ra" type="text">

        <br><br>
    </form>
    <button onclick="cadastrarAluno()">Cadastrar</button>

    <br><br>

    <div>Filtrar por ID:</div>
    <input id="filter-id" type="text">
    <button onclick="filterAlunoById()">Filtrar</button>

    <br><br>

    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Nome</th>
                <th>Ra</th>
            </tr>
        </thead>
        <tbody id="table-body">

        </tbody>
    </table>
</body>
<script>
    let apiURl = ""

    function atualizarTabela() {
        console.log("Atualizando tabela");
        const tableBody = document.getElementById("table-body");

        apiURl = "http://localhost:3000/aluno/all"
        fetch(apiURl).then(response => response.json()).then(data => {
            tableBody.innerHTML = '';
            tableBody.innerHTML = data.map(aluno => {
                return `
                <tr>
                    <td>${aluno.id}</td>
                    <td>${aluno.nome}</td>
                    <td>${aluno.ra}</td>
                </tr>
            `
            })
            console.log(data);
        }).catch((e) => {
            console.log(e);
        })

    }

    atualizarTabela();

    function cadastrarAluno() {
        const id = document.getElementById("id").value;
        const name = document.getElementById("name").value;
        const ra = document.getElementById("ra").value;


        const body = {
            id: parseInt(id),
            nome: name,
            ra: ra
        }


        const options = {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(body)
        }

        apiURl = "http://localhost:3000/aluno"
        fetch(apiURl, options)
            .then(() => {
                atualizarTabela();
            }).catch((e) => {
                console.log(e);
            })
    }

    function filterAlunoById() {
        const id = document.getElementById("filter-id").value.trim();;
        api = `http://localhost:3000/aluno/id/${id}`;

        const tableBody = document.getElementById("table-body");

        if(id === '') {
            atualizarTabela();
            return;
        }

        fetch(api).then(response =>
            response.json()
        ).then(data => {
            console.log(data);
            tableBody.innerHTML = '';
            tableBody.innerHTML =
            `
                <tr>
                    <td>${data.id}</td>
                    <td>${data.nome}</td>
                    <td>${data.ra}</td>
                </tr>
            `
            

        }).catch((e) => {
            console.log(e);
        })
    }



</script>

</html>